{% extends "base_trainer.html" %}

{% block trainer_content %}
<div class="panel trainer-panel">
  <div class="panel__heading">
    <h2>Users</h2>
    <p class="hero__subdued">Overview of everyone in training</p>
  </div>
  <div class="table-wrapper">
    <table class="data-table">
      <thead>
        <tr>
          <th>User</th>
          <th>Today</th>
          <th>Sleep</th>
          <th>Nutrition</th>
          <th>Fatigue</th>
          <th>Adherence</th>
          <th>Next session</th>
        </tr>
      </thead>
      <tbody>
        {% for person in people %}
        <tr
          class="clickable-row"
          data-row-href="{% url 'trainer_user' person.user.username %}"
          role="link"
          tabindex="0"
        >
          <td class="table-title">
            <div class="table-title__primary">{{ person.user.username }}</div>
            <div class="muted">{{ person.user.email|default:'Member' }}</div>
          </td>
          <td>{{ person.today_count }} planned</td>
          <td>{% if person.sleep_hours %}{{ person.sleep_hours }} hrs{% else %}—{% endif %}</td>
          <td>{% if person.nutrition %}{{ person.nutrition }}{% else %}—{% endif %}</td>
          <td>{% if person.fatigue %}{{ person.fatigue }} / 50{% else %}—{% endif %}</td>
          <td><span class="badge">{{ person.adherence }}%</span></td>
          <td>{% if person.next_day %}{{ person.next_day }}{% else %}—{% endif %}</td>
        </tr>
        {% empty %}
        <tr><td colspan="7">No users found yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".clickable-row").forEach((row) => {
        const href = row.getAttribute("data-row-href");
        if (!href) return;

        const activate = () => {
          window.location.href = href;
        };

        row.addEventListener("click", activate);
        row.addEventListener("keydown", (event) => {
          if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            activate();
          }
        });
      });
    });
  </script>
</div>
{% endblock %}
