{% extends "base_authenticated.html" %}

{% block title %}Health | Knees{% endblock %}

{% block content %}
<section class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
  <div class="absolute inset-0 bg-gradient-to-br from-slate-50 via-white to-white"></div>
  <div class="relative p-6 sm:p-10">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-end lg:justify-between">
      <div class="max-w-2xl">
        <p class="text-sm font-semibold text-indigo-600">Welcome back, {{ request.user.first_name|default:request.user.username }}</p>
        <h1 class="mt-3 text-3xl font-semibold tracking-tight text-slate-900 sm:text-4xl">{{ title }}</h1>
        <p class="mt-3 text-sm leading-6 text-slate-600 sm:text-base">{{ headline }}</p>
      </div>
      <div class="flex flex-col gap-3 sm:flex-row">
        <a href="{% url 'exercise_session' %}{{ session_cta_suffix }}" class="inline-flex items-center justify-center rounded-full bg-indigo-600 px-5 py-3 text-sm font-semibold text-white shadow-soft transition hover:bg-indigo-500">
          {{ session_cta_label }}
        </a>
      </div>
    </div>
  </div>
</section>

<div class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-12">
  <section class="lg:col-span-8">
    <div class="rounded-3xl border border-slate-200 bg-white shadow-soft">
      <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-6 py-5">
        <div>
          <h2 class="text-base font-semibold tracking-tight text-slate-900">Today’s plan</h2>
          <p class="mt-1 text-sm text-slate-600">Your schedule</p>
        </div>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700">
          {{ todays_exercises|length|default:0 }} exercises
        </span>
      </div>

      <div class="p-6">
        {% if todays_exercises %}
        <ol class="space-y-4">
          {% for item in todays_exercises %}
          <li class="rounded-2xl bg-white p-4 shadow-sm ring-1 ring-slate-200/70 transition hover:bg-slate-50">
            <div class="flex items-start justify-between gap-4">
              <div>
                <div class="text-sm font-semibold text-slate-900">
                  {{ item.exercise.name }}
                  {% if item.exercise.notes %}
                  <span class="font-normal text-slate-500">- {{ item.exercise.notes }}</span>
                  {% endif %}
                </div>
                {% if item.exercise.info %}
                <div class="mt-1 text-sm text-slate-600">{{ item.exercise.info }}</div>
                {% endif %}
              </div>
              <span class="inline-flex shrink-0 items-center rounded-full px-3 py-1 text-xs font-semibold text-slate-700">
                Difficulty {{ item.exercise.difficulty_range }}
              </span>
            </div>
          </li>
          {% endfor %}
        </ol>
        <div class="mt-6 rounded-2xl bg-slate-50 px-4 py-3 text-sm text-slate-700">
          Tip: keep movement <span class="font-medium text-slate-900">pain-free</span> and slow. Stop if pain spikes.
        </div>
        {% else %}
        <div class="rounded-2xl bg-slate-50 px-4 py-5 text-sm text-slate-700">No exercises scheduled for today yet. Come back after your plan is generated.</div>
        {% endif %}
      </div>
    </div>
  </section>

  <aside class="lg:col-span-4">
    <div class="rounded-3xl border border-slate-200 bg-white shadow-soft">
      <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-6 py-5">
        <div>
          <h2 class="text-base font-semibold tracking-tight text-slate-900">Health check</h2>
          <p class="mt-1 text-sm text-slate-600">Quick status for today</p>
        </div>
        <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700">{{ tasks|length|default:0 }} items</span>
      </div>

      <div class="p-3">
        <ul class="space-y-2">
          {% for task in tasks %}
          <li class="flex items-center justify-between gap-3 rounded-2xl bg-white px-4 py-3 text-sm ring-1 ring-slate-200/70 transition hover:bg-slate-50">
            <div class="flex items-center gap-3">
              <span class="flex h-8 w-8 items-center justify-center rounded-full {% if task.complete %}bg-emerald-50 text-emerald-600 ring-1 ring-emerald-200{% else %}bg-slate-50 text-slate-500 ring-1 ring-slate-200{% endif %}">
                {% if task.complete %}✓{% else %}○{% endif %}
              </span>
              <div>
                <p class="font-semibold text-slate-900">{{ task.title }}</p>
                {% if task.label %}
                <p class="text-xs text-slate-600">{{ task.label }}</p>
                {% endif %}
              </div>
            </div>
            <span class="text-xs font-semibold uppercase tracking-wide {% if task.complete %}text-emerald-600{% else %}text-slate-500{% endif %}">
              {% if task.complete %}Done{% else %}Pending{% endif %}
            </span>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </aside>
</div>
{% endblock %}
