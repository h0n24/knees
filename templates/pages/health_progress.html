{% extends "base_authenticated.html" %}
{% load static %}

{% block title %}Progress | Knees{% endblock %}

{% block content %}
<section class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
  <div class="absolute inset-0 bg-gradient-to-br from-slate-50 via-white to-white"></div>
  <div class="relative p-6 sm:p-10">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <p class="text-sm font-semibold text-indigo-600">Last 30 days</p>
        <h1 class="mt-3 text-3xl font-semibold tracking-tight text-slate-900 sm:text-4xl">{{ title }}</h1>
        <p class="mt-3 text-sm leading-6 text-slate-600 sm:text-base">{{ headline }}</p>
      </div>
      <div class="rounded-full bg-slate-100 px-4 py-2 text-xs font-semibold text-slate-700">Live metrics</div>
    </div>
  </div>
</section>

<section class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-2">
  <div class="rounded-3xl border border-slate-200 bg-white shadow-soft">
    <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-6 py-5">
      <div>
        <h2 class="text-base font-semibold tracking-tight text-slate-900">Training time</h2>
        <p class="mt-1 text-sm text-slate-600">Minutes per day</p>
      </div>
      <span class="inline-flex items-center rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-700">Line</span>
    </div>
    <div class="p-6">
      <p class="mb-4 text-sm text-slate-600">A smooth line to help you see momentum and spot dips quickly.</p>
      <div class="aspect-[4/3] w-full">
        <canvas id="training-chart" role="img" aria-label="Training minutes over the last 30 days"></canvas>
      </div>
    </div>
  </div>

  <div class="rounded-3xl border border-slate-200 bg-white shadow-soft">
    <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-6 py-5">
      <div>
        <h2 class="text-base font-semibold tracking-tight text-slate-900">Sleep schedule</h2>
        <p class="mt-1 text-sm text-slate-600">Hours each night</p>
      </div>
      <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700">Bars</span>
    </div>
    <div class="p-6">
      <p class="mb-4 text-sm text-slate-600">Simple bars so you can compare nights at a glance.</p>
      <div class="aspect-[4/3] w-full">
        <canvas id="sleep-chart" role="img" aria-label="Sleep hours over the last 30 days"></canvas>
      </div>
    </div>
  </div>

  <div class="rounded-3xl border border-slate-200 bg-white shadow-soft lg:col-span-2">
    <div class="flex items-center justify-between gap-4 border-b border-slate-200 px-6 py-5">
      <div>
        <h2 class="text-base font-semibold tracking-tight text-slate-900">Fatigue</h2>
        <p class="mt-1 text-sm text-slate-600">Daily check-in</p>
      </div>
      <span class="inline-flex items-center rounded-full bg-violet-50 px-3 py-1 text-xs font-semibold text-violet-700">Line</span>
    </div>
    <div class="p-6">
      <p class="mb-4 text-sm text-slate-600">A calm line to track how your energy is trending.</p>
      <div class="aspect-[16/5] w-full">
        <canvas id="fatigue-chart" role="img" aria-label="Fatigue scores over the last 30 days"></canvas>
      </div>
    </div>
  </div>
</section>

{{ progress_data|json_script:"progress-data" }}
<script src="{% static 'js/chart.umd.js' %}"></script>
<script>
    const progressData = JSON.parse(document.getElementById('progress-data').textContent);

    const chartDefaults = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: {
                ticks: { maxTicksLimit: 8, color: '#475569' },
                grid: { display: false }
            },
            y: {
                ticks: { color: '#475569' },
                grid: { color: 'rgba(148, 163, 184, 0.25)' }
            }
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: '#0f172a',
                titleColor: '#e2e8f0',
                bodyColor: '#cbd5e1',
            }
        }
    };

    const trainingCtx = document.getElementById('training-chart').getContext('2d');
    new Chart(trainingCtx, {
        type: 'line',
        data: {
            labels: progressData.labels,
            datasets: [{
                label: 'Training minutes',
                data: progressData.trainingMinutes,
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37, 99, 235, 0.12)',
                fill: true,
                tension: 0.35,
                pointRadius: 0
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                ...chartDefaults.scales,
                y: {
                    ...chartDefaults.scales.y,
                    title: { display: true, text: 'Minutes' }
                }
            }
        }
    });

    const sleepCtx = document.getElementById('sleep-chart').getContext('2d');
    new Chart(sleepCtx, {
        type: 'bar',
        data: {
            labels: progressData.labels,
            datasets: [{
                label: 'Sleep hours',
                data: progressData.sleepHours,
                backgroundColor: '#22c55e',
                borderRadius: 8,
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                ...chartDefaults.scales,
                y: {
                    ...chartDefaults.scales.y,
                    title: { display: true, text: 'Hours' },
                    suggestedMax: 10
                }
            }
        }
    });

    const fatigueCtx = document.getElementById('fatigue-chart').getContext('2d');
    new Chart(fatigueCtx, {
        type: 'line',
        data: {
            labels: progressData.labels,
            datasets: [{
                label: 'Fatigue score',
                data: progressData.fatigueScores,
                borderColor: '#a855f7',
                pointRadius: 0,
                tension: 0.35,
                borderDash: [6, 6]
            }]
        },
        options: {
            ...chartDefaults,
            scales: {
                ...chartDefaults.scales,
                y: {
                    ...chartDefaults.scales.y,
                    title: { display: true, text: 'Score' },
                    suggestedMin: 0
                }
            }
        }
    });
</script>
{% endblock %}
