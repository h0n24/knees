{% extends "base.html" %}

{% block content %}
<section class="relative overflow-hidden">
  <div class="pointer-events-none absolute inset-0">
    <div class="absolute left-1/2 top-[-18rem] h-[38rem] w-[38rem] -translate-x-1/2 rounded-full bg-gradient-to-tr from-indigo-500/20 via-sky-400/15 to-emerald-400/20 blur-3xl"></div>
    <svg class="absolute inset-0 h-full w-full stroke-slate-200/70 [mask-image:radial-gradient(60%_60%_at_50%_30%,#000_60%,transparent_100%)]" aria-hidden="true">
      <defs>
        <pattern id="login-grid" width="72" height="72" patternUnits="userSpaceOnUse" x="0" y="0">
          <path d="M72 0H0V72" fill="none"></path>
        </pattern>
      </defs>
      <rect width="100%" height="100%" stroke-width="0" fill="url(#login-grid)"></rect>
    </svg>
  </div>

  <div class="relative mx-auto flex min-h-screen max-w-4xl items-center justify-center px-6 py-16 sm:py-20">
    <div class="w-full max-w-2xl rounded-2xl bg-white/90 px-8 py-10 shadow-xl ring-1 ring-slate-900/5 backdrop-blur sm:px-10 sm:py-12">
      <header class="space-y-2">
        <p class="text-sm font-semibold uppercase tracking-wider text-indigo-600">{{ title|default:"Sign In" }}</p>
        <h1 class="text-4xl font-semibold tracking-tight sm:text-5xl">Welcome back</h1>
        <p class="text-sm text-slate-700">
          New to Knees?
          <a class="font-medium text-indigo-600 hover:underline" href="/auth/register/">Create an account</a>.
        </p>
      </header>

      <form class="mt-10 space-y-6" method="post" novalidate>
        {% csrf_token %}
        {% if form.non_field_errors %}
          <div class="rounded-xl bg-rose-50 p-4 text-sm text-rose-700 ring-1 ring-inset ring-rose-200">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div>
          <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-slate-900">Username or email</label>
          <div class="mt-2">
            {{ form.username.as_widget(attrs={
              'class': 'block w-full rounded-md border-0 bg-slate-50 px-4 py-3 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-200 placeholder:text-slate-400 placeholder:text-sm focus:ring-2 focus:ring-inset focus:ring-indigo-600',
              'placeholder': 'Your username or email',
              'autocomplete': 'username'
            }) }}
            {% if form.username.errors %}
              <p class="mt-2 text-sm text-rose-600">{{ form.username.errors|join:", " }}</p>
            {% endif %}
          </div>
        </div>

        <div>
          <label for="{{ form.password.id_for_label }}" class="block text-sm font-medium text-slate-900">Password</label>
          <div class="relative mt-2">
            {{ form.password.as_widget(attrs={
              'class': 'block w-full rounded-md border-0 bg-slate-50 px-4 py-3 pr-12 text-slate-900 shadow-sm ring-1 ring-inset ring-slate-200 placeholder:text-slate-400 placeholder:text-sm focus:ring-2 focus:ring-inset focus:ring-indigo-600',
              'placeholder': 'Your password',
              'id': form.password.id_for_label
            }) }}
            <button type="button" class="absolute inset-y-0 right-0 flex items-center rounded-r-md px-3 text-slate-500 transition hover:text-slate-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-600 focus-visible:ring-offset-2" aria-label="Toggle password visibility" data-toggle-password="{{ form.password.id_for_label }}">
              <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path data-eye-on d="M10 3C5.5 3 2 7.1 1 10c1 2.9 4.5 7 9 7s8-4.1 9-7c-1-2.9-4.5-7-9-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"></path>
                <path data-eye-off class="hidden" d="M2.3 3.7a1 1 0 0 1 1.4-1.4l13.6 13.6a1 1 0 0 1-1.4 1.4l-1.8-1.8A9.7 9.7 0 0 1 10 17c-4.5 0-8-4.1-9-7 .6-1.6 1.9-3.5 3.7-5.1L2.3 3.7Zm5.1 5.1a2.5 2.5 0 0 0 3.5 3.5L7.4 8.8Zm4-1.1 1.9 1.9c.1-.2.2-.5.2-.8a3.5 3.5 0 0 0-3.5-3.5c-.3 0-.6.1-.8.2l2 2.2Z"></path>
              </svg>
            </button>
          </div>
          {% if form.password.errors %}
            <p class="mt-2 text-sm text-rose-600">{{ form.password.errors|join:", " }}</p>
          {% endif %}
        </div>

        <div class="flex items-center justify-between gap-4">
          <label class="flex items-center gap-3 text-sm text-slate-700">
            <input type="checkbox" name="remember" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-600" />
            Remember me
          </label>
          <a href="/auth/register/" class="text-sm font-semibold text-indigo-600 hover:underline">Need an account?</a>
        </div>

        <button type="submit" class="group inline-flex w-full items-center justify-center rounded-full bg-indigo-600 px-4 py-4 text-sm font-semibold text-white shadow-md transition hover:bg-indigo-500 hover:text-slate-100 active:bg-indigo-800 active:text-indigo-100 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
          Sign in
        </button>
      </form>
    </div>
  </div>
</section>

<script>
  for (const btn of document.querySelectorAll('[data-toggle-password]')) {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-toggle-password');
      const input = document.getElementById(id);
      if (!input) return;

      const wasPassword = input.getAttribute('type') === 'password';
      input.setAttribute('type', wasPassword ? 'text' : 'password');

      const svg = btn.querySelector('svg');
      const eyeOn = svg?.querySelector('[data-eye-on]');
      const eyeOff = svg?.querySelector('[data-eye-off]');
      if (eyeOn && eyeOff) {
        eyeOn.classList.toggle('hidden', wasPassword);
        eyeOff.classList.toggle('hidden', !wasPassword);
      }
    });
  }
</script>
{% endblock %}
