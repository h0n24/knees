{
  "$schema": "https://railway.com/railway.schema.json",
  "build": {
    "builder": "RAILPACK",
    "buildCommand": "python3 -m pip install -r requirements.txt"
  },
  "deploy": {
    "preDeployCommand": [
      "python3 manage.py migrate && python3 manage.py collectstatic --noinput && python3 manage.py shell -c \"import os; from django.contrib.auth import get_user_model; User=get_user_model(); username=os.getenv('DJANGO_ADMIN_USER','admin'); password=os.getenv('DJANGO_ADMIN_PASSWORD'); email=os.getenv('DJANGO_ADMIN_EMAIL','admin@example.com'); assert password, 'Missing DJANGO_ADMIN_PASSWORD'; u,_=User.objects.get_or_create(username=username, defaults={'email': email}); u.email=email; u.is_staff=True; u.is_superuser=True; u.set_password(password); u.save();\""
    ],
    "startCommand": "bash -lc \"python3 manage.py migrate --noinput && python3 -m gunicorn apps.backend.config.wsgi:application --bind 0.0.0.0:${PORT:-8000}\"",
    "healthcheckPath": "/"
  }
}
